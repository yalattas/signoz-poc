resources:
  - apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: django
    spec:
      selector:
        matchLabels:
          app.kubernetes.io/instance: django
          app.kubernetes.io/name: django
      strategy:
        rollingUpdate:
          maxSurge: 25%
          maxUnavailable: 25%
        type: RollingUpdate
      template:
        metadata:
          labels:
            app.kubernetes.io/instance: django
            app.kubernetes.io/managed-by: Helm
            app.kubernetes.io/name: django
        spec:
          containers:
          - name: django
            env:
            - name: DEBUG
              value: "true"
            - name: DJANGO_SETTINGS_MODULE
              value: "conf.settings"
            - name: OTEL_ENABLED
              value: "true"
            - name: OTEL_PYTHON_DJANGO_INSTRUMENT
              value: "true"
            - name: OTEL_LOG_LEVEL
              value: "DEBUG"
            - name: OTEL_SERVICE_NAME
              value: "django-service"
            - name: OTEL_EXPORTER_OTLP_ENDPOINT
              value: "http://signoz-otel-collector.signoz.svc.cluster.local:4317"
            image: yasser/django:v0.7.9
            imagePullPolicy: IfNotPresent
            ports:
            - containerPort: 8000
              name: django
              protocol: TCP
          serviceAccount: default
          serviceAccountName: default
          terminationGracePeriodSeconds: 5
  - apiVersion: v1
    kind: Service
    metadata:
      name: django
    spec:
      type: ClusterIP
      ports:
      - name: django
        port: 8000
        protocol: TCP
        targetPort: django
      selector:
        app.kubernetes.io/name: django

  - apiVersion: networking.istio.io/v1
    kind: VirtualService
    metadata:
      name: django
    spec:
      gateways:
        - istio-system/global-gateway
      hosts:
        - "*"
      http:
        - match:
            - uri:
                prefix: /
          route:
            - destination:
                host: django
                port:
                  number: 8000